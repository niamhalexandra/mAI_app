<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mAI Journal App</title>
</head>
<body>
    <h1>Welcome to mAI Journal App!</h1>
    
    <!-- Display Image -->
    <img src="{{ url_for('static', filename='epad.png') }}" alt="mAI Journal" style="max-width: 100%; height: auto;">

    <!-- Button to start/stop recording and display transcription -->
    <button id="recordButton">Start Recording</button>
    <p id="transcription">Transcription will appear here...</p>

    <script>
        let isRecording = false;
        let mediaRecorder;
        let audioChunks = [];

        document.getElementById('recordButton').onclick = async function() {
            if (!isRecording) {
                isRecording = true;
                this.innerText = 'Stop Recording';

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);

                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = async () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        audioChunks = [];

                        const formData = new FormData();
                        formData.append('audio', audioBlob, 'audio.wav');

                        try {
                            const response = await fetch('/transcribe', {
                                method: 'POST',
                                body: formData
                            });

                            if (response.ok) {
                                const data = await response.json();
                                document.getElementById('transcription').innerText = data.transcription || "No transcription available.";
                            } else {
                                const errorData = await response.json();
                                document.getElementById('transcription').innerText = errorData.error || "An unknown error occurred.";
                            }
                        } catch (networkError) {
                            document.getElementById('transcription').innerText = "Network error occurred.";
                        }
                    };

                    mediaRecorder.start();
                } catch (err) {
                    alert("Could not access microphone. Please check permissions.");
                }
            } else {
                isRecording = false;
                this.innerText = 'Start Recording';
                mediaRecorder.stop();
            }
        };
    </script>
</body>
</html>








